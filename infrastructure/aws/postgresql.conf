# PostgreSQL 메모리 최적화 설정
# EC2 t3.micro (1GB RAM) 환경에 맞춘 설정
# Docker 컨테이너 메모리 제한: 400MB

# 공유 메모리 버퍼 (전체 메모리의 약 25%, 400MB 제한에 맞춤)
shared_buffers = 64MB

# OS와 PostgreSQL이 함께 사용할 수 있는 예상 캐시 크기
# 실제 메모리보다 작게 설정 (메모리 제한 고려)
effective_cache_size = 128MB

# 유지보수 작업(인덱스 생성, VACUUM 등)에 사용되는 메모리
maintenance_work_mem = 32MB

# 정렬 및 해시 작업에 사용되는 메모리 (쿼리당)
# 동시 쿼리 수를 고려하여 작게 설정
work_mem = 4MB

# 최대 연결 수 (메모리 제한에 맞춰 조정)
# 각 연결은 work_mem을 사용할 수 있으므로 제한 필요
max_connections = 50

# 자동 VACUUM 설정 (메모리 사용 최적화)
autovacuum = on
autovacuum_max_workers = 2

# WAL (Write-Ahead Logging) 설정
wal_buffers = 4MB
checkpoint_completion_target = 0.9

# 쿼리 플래너 설정
random_page_cost = 1.1  # SSD 환경에 맞춤
effective_io_concurrency = 200  # SSD 환경에 맞춤

